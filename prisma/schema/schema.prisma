generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model TravelPlan {
  id           String     @id @default(uuid())
  userId       String
  title        String
  description  String?    @db.Text
  destination  String
  country      String?
  startDate    DateTime
  endDate      DateTime
  budgetMin    Int?
  budgetMax    Int?
  travelType   TravelType @default(SOLO)
  maxTravelers Int?
  status       TripStatus @default(PLANNING)
  isPublic     Boolean    @default(true)
  image        String?
  activities   String[]   @default([])
  isDeleted    Boolean    @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user          User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  requests      TravelRequest[]
  reviews       Review[]
  // reviews  Review[]
  travelMatches TravelMatch[]

  @@map("travel_plans")
}

model TravelRequest {
  id           String        @id @default(uuid())
  travelPlanId String
  requesterId  String
  receiverId   String
  message      String?       @db.Text
  status       RequestStatus @default(PENDING)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  travelPlan TravelPlan @relation(fields: [travelPlanId], references: [id], onDelete: Cascade)
  requester  User       @relation("SentRequests", fields: [requesterId], references: [id])
  receiver   User       @relation("ReceivedRequests", fields: [receiverId], references: [id])

  @@unique([travelPlanId, requesterId])
  @@map("travel_requests")
}

model TravelMatch {
  id           String   @id @default(uuid())
  travelPlanId String
  user1Id      String
  user2Id      String
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())

  travelPlan TravelPlan @relation(fields: [travelPlanId], references: [id], onDelete: Cascade)

  @@unique([travelPlanId, user1Id, user2Id])
  // @@index([user1Id])
  // @@index([user2Id])
  @@map("travel_matches")
}

model Payment {
  id                 String        @id @default(uuid())
  userId             String
  amount             Decimal       @db.Decimal(10, 2)
  transactionId      String        @unique
  paymentGatewayData Json?
  status             PaymentStatus @default(PENDING)
  metadata           Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user           User    @relation(fields: [userId], references: [id])
  // subscription   Subscription? @relation(fields: [subscriptionId], references: [id])
  subscriptionId String?

  @@index([userId])
  @@index([status])
  @@index([transactionId])
  @@map("payments")
}

model Subscription {
  id                   String             @id @default(uuid())
  userId               String
  stripeSubscriptionId String
  // paymentId String             @unique
  // amount               String?
  amount               Decimal?            @db.Decimal(10, 2)
  plan                 SubscriptionPlan
  status               SubscriptionStatus @default(ACTIVE)
  startDate            DateTime           @default(now())
  endDate              DateTime
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt

  user User @relation(fields: [userId], references: [id])
  // payment Payment @relation(fields: [paymentId], references: [id])
  // payments Payment[]

  @@map("subscriptions")
}

model User {
  id        String  @id @default(uuid())
  email     String  @unique
  password  String
  role      Role    @default(USER)
  isActive  Boolean @default(true)
  isDeleted Boolean @default(false)

  // Profile
  fullName         String
  profileImage     String?
  bio              String?  @db.Text
  phone            String?
  currentLocation  String?
  gender           Gender?
  isVerified       Boolean  @default(false)
  interests        String[] @default([])
  visitedCountries String[] @default([])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  payments         Payment[]
  sentRequests     TravelRequest[] @relation("SentRequests")
  receivedRequests TravelRequest[] @relation("ReceivedRequests")
  // userTravelInterests UserTravelInterest[]
  travelPlans      TravelPlan[]
  reviewsGiven     Review[]        @relation("ReviewsGiven")
  reviewsReceived  Review[]        @relation("ReviewsReceived")
  subscriptions    Subscription[]

  @@index([email])
  @@index([role])
  @@index([fullName])
  @@map("users")
}

model Review {
  id             String   @id @default(uuid())
  fromReviewerId String
  toReviewerId   String
  tourPlanId     String
  rating         Int // 1-5 stars
  comment        String?  @db.Text
  isPublic       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  formReviewer   User       @relation("ReviewsGiven", fields: [fromReviewerId], references: [id], onDelete: Cascade)
  tourPlanReview TravelPlan @relation(fields: [tourPlanId], references: [id], onDelete: Cascade)
  toReviewer     User       @relation("ReviewsReceived", fields: [toReviewerId], references: [id], onDelete: Cascade)

  @@unique([fromReviewerId, toReviewerId])
  @@index([rating])
  @@map("reviews")
}

enum Role {
  SUPER_ADMIN
  USER
  ADMIN
}

enum Gender {
  MALE
  FEMALE
}

enum UserStatus {
  ACTIVE
  BANNED
  SUSPENDED
}

enum TravelType {
  SOLO
  FAMILY
  COUPLE
  FRIENDS
}

enum SubscriptionPlan {
  FREE
  MONTHLY
  YEARLY
}

enum SubscriptionStatus {
  ACTIVE
  EXPIRED
  PENDING
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
}

enum TripStatus {
  PLANNING
  UPCOMING
  ONGOING
  COMPLETED
  CANCELLED
}

enum RequestStatus {
  PENDING
  ACCEPTED
  REJECTED
  CANCELLED
}
